viewers wrong cell editor activated table refresh build steps reproduce demonstrate problem modified snippet table viewer sorting click tod enter editor change zebra press enter items rearranged table refresh point easier demonstrate problem press enter strange behavior wrong editor previous item position activated correct content modified snippet package org eclipse swt snippets import org eclipse core runtime assert import org eclipse jface viewers cell editor import org eclipse jface viewers column label provider import org eclipse jface viewers column viewer import org eclipse jface viewers column viewer editor import org eclipse jface viewers column viewer editor activation event import org eclipse jface viewers column viewer editor activation strategy import org eclipse jface viewers editing support import org eclipse jface viewers focus cell highlighter import org eclipse jface viewers structured content provider import org eclipse jface viewers table viewer import org eclipse jface viewers table viewer column import org eclipse jface viewers table viewer editor import org eclipse jface viewers table viewer focus cell manager import org eclipse jface viewers text cell editor import org eclipse jface viewers viewer import org eclipse jface viewers viewer cell import org eclipse jface viewers viewer comparator import org eclipse jface viewers viewer row import org eclipse swt import org eclipse swt events key event import org eclipse swt events selection adapter import org eclipse swt events selection event import org eclipse swt graphics color import org eclipse swt graphics import org eclipse swt graphics rectangle import org eclipse swt layout fill layout import org eclipse swt widgets display import org eclipse swt widgets event import org eclipse swt widgets listener import org eclipse swt widgets shell import org eclipse swt widgets table item import swtdesigner resource manager usage viewer comparator tables sorting author tom schindl tom schindl bestsolution public class snippet table viewer sorting private class content provider implements structured content provider public object elements object input element return person input element public void dispose public void input changed viewer viewer object input object input public class person public string givenname public string surname public string email public person string givenname string surname string email givenname givenname surname surname email email protected abstract class abstract editing support extends editing support private text cell editor editor public abstract editing support table viewer viewer super viewer editor text cell editor viewer table protected boolean edit object element return true protected cell editor cell editor object element return editor protected void set object element object set element viewer update element null table viewer table viewer table viewer viewer table item item table viewer table item table viewer table selection object obj item data refresh table table viewer refresh search item object selected item table item itemtoselect null table item items table viewer table items table item items data equals obj itemtoselect select item table viewer table set selection itemtoselect protected abstract void set object element object public snippet table viewer sorting shell shell table viewer table viewer shell set content provider content provider final table viewer focus cell manager focus cell manager table viewer focus cell manager editable focus cell highlighter column viewer editor activation strategy support column viewer editor activation strategy protected boolean editor activation event column viewer editor activation event event event source event instanceof key event event key code event key code key event event source event doit false return event event type column viewer editor activation event event event type column viewer editor activation event event event type column viewer editor activation event event key code event key code event event type column viewer editor activation event event key code event event type column viewer editor activation event event key code event event type column viewer editor activation event event key code event event type column viewer editor activation event table viewer editor create focus cell manager support column viewer editor column viewer editor column viewer editor column viewer editor table viewer column column table viewer column column column set width column column set text givenname column column set moveable true column set label provider column label provider public string text object element return person element givenname column set editing support abstract editing support protected object object element return person element givenname protected void set object element object person element givenname string column viewer sorter sorter column viewer sorter column protected int compare viewer viewer object object person person person person return givenname compare ignore case givenname column table viewer column column column set width column column set text surname column column set moveable true column set label provider column label provider public string text object element return person element surname column set editing support abstract editing support protected object object element return person element surname protected void set object element object person element surname string column viewer sorter column protected int compare viewer viewer object object person person person person return surname compare ignore case surname column table viewer column column column set width column column set text mail column column set moveable true column set label provider column label provider public string text object element return person element email column set editing support abstract editing support protected object object element return person element email protected void set object element object person element email string column viewer sorter column protected int compare viewer viewer object object person person person person return email compare ignore case email person model create model set input model table set lines visible true table set header visible true sorter set sorter sorter column viewer sorter private person create model person elements person elements person tom schindl tom schindl bestsolution elements person boris bokowski boris bokowski ibm elements person tod creasey tod creasey ibm elements person wayne beaton wayne eclipse org return elements private static abstract class column viewer sorter extends viewer comparator public static final int public static final int public static final int private int direction private table viewer column column private column viewer viewer public column viewer sorter column viewer viewer table viewer column column column column viewer viewer column column add selection listener selection adapter public void widget selected selection event column viewer sorter viewer comparator null column viewer sorter viewer comparator column viewer sorter int tdirection column viewer sorter direction tdirection set sorter column viewer sorter tdirection set sorter column viewer sorter set sorter column viewer sorter set sorter column viewer sorter public void set sorter column viewer sorter sorter int direction direction column column parent set sort column null column column parent set sort direction viewer set comparator null column column parent set sort column column column sorter direction direction direction column column parent set sort direction column column parent set sort direction viewer comparator sorter viewer refresh viewer set comparator sorter public int compare viewer viewer object object return direction compare viewer protected abstract int compare viewer viewer object object private class editable focus cell highlighter extends focus cell highlighter private viewer cell cell param viewer viewer public editable focus cell highlighter column viewer viewer super viewer hook listener viewer private void mark focused cell event event viewer cell cell event set background resource manager color set foreground resource manager color set width int current col event rectangle rect table item event item bounds current col draw rectangle rect event detail event detail focus event detail private void remove selection event event viewer cell cell private void hook listener final column viewer viewer listener listener listener public void handle event event event event detail viewer cell focus cell focus cell viewer row row focus cell viewer row assert null row internal structure invalid item row viewer cell cell row cell event focus cell null cell equals focus cell remove selection event cell mark focused cell event cell viewer control add listener erase item listener param cell cell colored return color protected color selected cell background color viewer cell cell return null param cell cell colored return color protected color selected cell foreground color viewer cell cell return null javadoc org eclipse jface viewers focus cell highlighter focus cell changed org eclipse jface viewers viewer cell protected void focus cell changed viewer cell cell super focus cell changed cell redraw area cell null rectangle rect cell bounds int cell column rect int width cell column rect rect width rect width linux cell control redraw rect width rect height true cell null rectangle rect cell bounds int cell column rect int width cell column rect rect width rect width linux cell control redraw rect width rect height true cell cell param args public static void main string args display display display shell shell shell display shell set layout fill layout snippet table viewer sorting shell shell open shell disposed display read dispatch display sleep display dispose created attachment snippet demonstrate bug snippet copy pasted attachment moving assign created attachment problem updating focus cell appropiately selection changed strucuture viewer set selection note control set selection work won required events workaround call table viewer edit element element refresh viewer method fixing problem editor editing mode async exec call protected void set final object element object set element viewer update element null final table viewer table viewer table viewer viewer table viewer refresh display current async exec runnable public void table viewer edit element element bad idea refresh set method add column viewer editor activation listener listener column viewer editor refresh async call comment attachment redesign created attachment real problem focus cell manager informed selection level occur resorting boris candidate created attachment commented workaround changed editor activation event column viewer editor activation event bit column viewer editor activation strategy support column viewer editor activation strategy protected boolean editor activation event column viewer editor activation event event event source event instanceof key event event key code event key code key event event source event doit false event event type column viewer editor activation event event key code event event type column viewer editor activation event event key code event event type column viewer editor activation event event key code event source event instanceof key event event key code event key code event event type column viewer editor activation event int viewer cell event source column edit element viewer cell event source element return event event type column viewer editor activation event event event type column viewer editor activation event problem activation editor key pressed event don implementation cell editor key pressed needed character key event editor don solve moment code viewer cell updated correctly draw editor activated short time solve setting editor edit mode false short time admit ideal update selection viewer set selection append call viewer edit element hope promise reply comment code viewer cell updated correctly draw editor activated short time solve setting editor edit mode false short time code editor active solution set edit mode false short time don moment admit ideal update selection viewer set selection append call viewer edit element hope promise solution don call viewer edit element time drawbacks wait setting editor editable update happening work protected void save cell editor cell editor cell editor viewer cell cell super save cell editor cell editor cell table viewer table viewer table viewer viewer table viewer refresh table viewer edit element cell element cell column relying internals editor activated break future version fixed problem advice remove workaround wrap clause solve problem sorting table cell editor table cell editor text cell editor activate column viewer editor activation event set text select set focus ends endless loop table cell editor activate column viewer editor activation event public void activate column viewer editor activation event event event key code event key code text set text event character text text text set selection possibility subclass table viewer focus cell manager access som methods reflection work performance hit big methods reflection block note feeling provide listener viewers inform interested parties refresh resort filter definately set selected cell side structured selection rows bug reply comment possibility subclass table viewer focus cell manager access som methods reflection work performance hit big methods reflection block sounds good don reflection don created attachment reflection approach haven thought algorithm find methods query loop find relies implementation details method names break future versions created attachment patch commented parts created attachment mylyn context zip missed cut ready review fixes problem listener structural viewer refresh filter sort created attachment apply idea attachment problem loosing focused cell set input refresh lazy content provider restore selection selected cell code fixing problem public viewer cell focus cell viewer cell cell super focus cell table viewer table cell null selection length choose cell selection internal methods people call reflection freeze missed created attachment test snippet boris released problem common viewers resorted focus indicator fixed entering bugs filed bug focus indicator problem verified running attached snippet
 