common navigator navigator content descriptor manager evaluation cache descriptors work org internal navigator extensions navigator content descriptor manager evaluation cache descriptors return null key inserted using set descriptors navigator content descriptor manager evaluation cache attempts prevent memory leak caching long wrapping key evaluation reference set descriptor set descriptors method account tries key using original object course fails given standard hash map used evaluations evaluations overrides evaluation reference equals return false violate symmetry requirement equals exposed navigator content descriptor manager itself descriptors possible child descriptors trigger point descriptors calls descriptors method cache wrapping key way internal flaw having performance implications public simple code snippet reproduce pretend moment evaluation cache isn private navigator content descriptor manager evaluation cache cache way cache hard references ensure isn responsible string key key navigator content descriptor descriptors navigator content descriptor cache set descriptors key descriptors navigator content descriptor fetched descriptors cache descriptors key fetched descriptors null throw assertion error entry assertion error time suggested fix short term evaluations evaluations overrides weak hash map don bother wrapping key custom reference implementation weak hash map uses equals underlying object instead weak reference fact values stored soft references prevent issue unfortunate downside making keys weak instead intended soft evalutation reference extends soft reference right aren getting things anyways long term use custom map implementation properly packs unpacks requests ensuring underlying object equality used reference object itself unlike weak hash map use specialized reference implementation evalutation reference trying accomplish allowing evalutation reference soft weak keys soft reference values reference queue registered stale entries cleaned promptly evaluation cache instance map entries keys collected current entry time lazy method stale entries expunged likely existing cache maps implemented nicely risks clients worked wrapping key queries evalutation reference fixing cause break couldn usages don stop fixed evalutation reference internal class outside common navigator directly using class untested potentially buggy code start cache actually starts returning results
 