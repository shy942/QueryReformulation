undo api clarif thread issu conven respect callback notif compon oper histori oper histori notifi client oper histori occur client work updat action handler enabl client refactor flush oper histori background thread gener oper framework forc client thread dispatch callback thread tell client call thread explicitli syncexec asyncexec protocol access oper histori callback current scenario text editor undo oper stack thread process type assum notif oper approv origin thread explic displai protocol text undo simpl fast refactor oper typic stack open close composit oper sequenc refactor oper increment execut execut oper framework api close oper add stack thread problem initi implement assump typic thread remov action handler origin start refactor oper don code deep support notifi oper notif trigger background work refactor result call framework flush stack background thread remov oper stack flush start problem client remov notif thread undo redo action handler updat enabl stack dirk experi background job flus refactor histori case flush stack background simpler oper exampl test case real client oper stack action handler origin oper core command oper headless common support undo gut feel origin wrong notifi client background thread complet reason flush histori background thread framework check headless doesn swt overhead call displai syncexec thread pretti neglig don mind docum client displai syncexec receiv notif oper framework don undu perform burden text imo oper histori sync event process code thread common pattern eclips listen post event thread process thread case javamodel delta resourc delta notif requir client call method oper framework thread client headless doesn swt thread refactor add undo modal context thread histroi chang doesn requir execut thread docum manipl thread undo thread framework doesn enforc kind undo thread valid call oper framework thread thread safe represent histori protect lock lock held listen notif avoid deadlock jface text thread safe expect call thread undo redo action handler text undo manag updat handl background thread case releas text undo manag displai syncexec notif oper histori syncexec notif fire type delai introduc async action handler displai asyncexec updat base histori notif work lock undo redo histori nick plan updat javadoc api add listen explain notif call background thread listen access displai sync async protocol api clarif safe releas pmc approv verifi true attach patc oper framework test suit john feel job thread savvi person check addition comment lock sugges test case help test oper test suit background thread run flush listen problem privat exampl histori view creat attach org eclips core command patch oper framework synchron access undo redo list creat attach org eclips test patch thread test oper test suit verifi true api clarif fine add pmc approv comment patch synchron undolist redolist surround access synchron list fine simpler wrap synchron wrapper privat list redolist collec synchronizedlist arraylist code cumberso help avoid accident slip requir synchron miss operationchang method note synchron wrapper doesn prevent synchron replaceoper method atom remov item add item synchron list block case synchron list iter patch synchron call client code place hold lock call client code getredooper replaceoper filter call method iundoableoper wasn late make relev method final abstractoper call method implem framework subclass overrid introduc lock problem turn problem safer call method hold lock minor note iundoableoper doesn spec implem client implem client make method final abstractoper wouldn guarante safeti field miss synchron field defaultoperationhistori miss synchron approv lim listen recommend synchron wrapper collec extern factor don solv client burn multi thread natur histori client call histori canundo context histori undo context thread add histori client undo unexpect oper caus undo fail client avoid call iundoableoper histori getundooper context null histori undo don rare case thought worth mention quick class attach patch avoid synchron histroi histori canundo context histori undo context client style operaiton histori aquir lock review john see problem decision reopen bug reexamin synchron wrapper undolist redolist retain synchron block situat replaceoper implement synchron add replac filter implement synchron iter getundooper getredooper synchron search oper implement iundoableoper expect legaci command framework expect implem interfac particip common undo redo method call synchron block iundoableoper hascontext iundocontext iundoableoper getcontext updat spec method explicitli call synchron block client wait lock call docum case mark addition method abstractoper final synchron wrapper data structur note approv listen list iter order notifi client approv listen remov loop synchron block purpos notifi listen listen list wors big listen remov iter risk implem doubl check indic loop extern factor point chanc mismatch expect undo redo oper occur thread add oper current oper perform undo redo action handler typic drive undo redo updat base notif occur oper technic keep latest oper suppos chanc time user pop menu select undo redo time handler run chang live risk problem don litter client synchron code introduc deadlock releas head test case build iter concurr modif check throw concurrentmodificationexcep arrayindexoutofboundsexcep clue happen forgiv stick nose want chang come synchron collec work case won suffici assum defaultoperationhistori undo defaultoperationhistori redo defaultoperationhistori addoper background thread odd behaviour addoper doundo doredo interleav start addoper switch tread perform redo expect behaviour redo fail redo redo succe minor interest assu undo stack oper redo stack oper context start redo oper thread interrupt attempt undo oper complet undon control return thread scenario move direc simultan undo redo stack imposs undo redo stack manipul atom actual execu undo redo kind situat recommend time deadlock code odd behaviour corrupt intern data structur doug feedback scenario describ occur reentrant call thread perform redo oper oper trigger code execut undo oper complet return redo gener concern express comment john extern factor remark implement guarante undo redo atom sequenti transac queue request perform sequenc question enforc kind model fyi client undo implement gef emf text refactor agre make remark thread safeti open discus differ call thread call thread thread plug mechan synchron don wrap method critic section synchron block prevent kind problem case entranc thread trickier current implement minim amount client code call synchron block minim deadlock critic method call client oper work lack protec beef synchron reentranc unexpect scenario question guidanc agre theoret vulner construct test case involv concurr reentrant undo redo unexpect realiti correct wrong concurr undo redo happen practic undo redo invok thread modal context thread block user interac durat worst case current code thread safeti ensur data structur won corrupt deadlock risk minim workbench api concurr enabl thread safe place matter side discus doug tod investig lock kei object call undo redo modifi concurr updat prevent work undo redo stack solv reentranc issu guard multi thread case involv introduc larger block synchron code move listen notif block risk oper perform undo redo deadlock creat thread attempt modifi histori wait start comment approach welcom rearrang listen notif introduc issu exist client choos approach report clear comment understand side convers call undo framework happen thread refactor call background thread call thread john comment comment interpret dirk explain comment describ refactor undo risk current implement latest approach defin kei undo redo histori synchron undolist redolist synchron kei synchron kei addition situat doundo success oper move undo redo stack doredo success oper move redo undo stack add oper undo stack prevent main scenario doug mention comment remain case complet guard flush histori context add addition synchron case method filter histori context kei time flush request histori lock filter undo context histori updat determin flush addition inser histori undo context filter list iter flush left doesn destabil data structur outbound notif flush guarante histori empti undo context flush context histori thread reentrantli work problem adapt listen approv iter copi listen approv list prevent alter list iter hope api listenerlist releas head edt build test oper text refactor pass attach patch doug tod doubl check leav bug open concurr dougp voic concern hole left implement patch releas isn help review compar defaultoperationhistori revision work won close doug chang mileston creat attach patch defaultoperationhistori patch comment concern api contract icompositeoper client ioperationhistori suppos interact interfac add remov comment api make method thread safe access opencomposit protect start bit protec patch realiz member variabl null point couldn decid protect lock provid separ lock partli perform decision doug doug review patc comment incorpor idea suggest excep chang flushundo flushredo forceundolim forceredolim lock entir method undo redo list modifi method remov oper filter list comment maintain integr data structur protect lock method send notif think lock prevent lot unnecessari duplic flush case don multipl thread iter list remov oper synchron entir method deadlock thread test case simpl lock filter attempt guard flush scenario driven actual problem rearrang lock replac method ensur replac oper occur lock notifi listen lock lock entir method agre open composit protec open composit modal histori independ undo redo historit guard lock easiest chang open composit variabl arrai singl composit lock variabl lock composit check reset histori guard multipl open composit throw excep caller attempt open composit open lock place variabl check alter suffici standpoint oper histori composit protect access api client provid composit choos add remov children composit open thread problem claim thread safeti icompositeoper modifi spec ioperationhistori openoper client modifi composit open creat attach org eclips core command patch propos defaultoperationhistori ioperationhistori nick approv propos latest patch main chang synchron access open composit maintain oper histori implement guard multipl open throw illegalstateexcep bug thread interrupt open close place caus unpredict propos synchron access set open oper open close open close complet thread affect open composit oper open composit synchron chang test oper text refactor test undo chang good chang opencomposit singl elem arrai synchron bit hackoid prefer separ lock object exist lokc recalibr hack meter chang code lock specif object opencomposit code releas close bug encount specif issu thread problem oper histori address verifi code inspec oper test suit
 